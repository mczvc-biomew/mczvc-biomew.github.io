var G=Object.defineProperty;var V=(s,e,t)=>e in s?G(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var n=(s,e,t)=>V(s,typeof e!="symbol"?e+"":e,t);import{_ as R}from"./CaZSYPcW.js";import{j as y,d as W,i as j,a as u,E as k,W as D,k as U,G as z,l as J,o as N,c as q,m as $,e as O,n as X,M as Y,N as Z,q as K,T as Q,P as g,H as p,z as ee,aD as H,I as te,_ as se}from"./Wdm5Bd6v.js";import{s as ne}from"./BVFCvoEa.js";const oe=512;function ie(){return new Promise((s,e)=>{try{window.AudioContext=window.AudioContext??window.webkitAudioContext,s(new window.AudioContext)}catch(t){console.info("Web Audio API is not supported.",t),e(t)}})}function ae(s){const e=s.createAnalyser();return e.smoothingTimeConstant=.6,e.fftSize=oe,e}function re(s){return new Uint8Array(s.frequencyBinCount)}function le(s,e,t,o=()=>{}){const i=e.createBufferSource();return i.loop=t,i.connect(s),i.connect(e.destination),i.onended=function(){o()},i}function ue(s,e){let t=new XMLHttpRequest;t.open("GET",s,!0),t.responseType="arraybuffer",t.onload=function(){e(t.response)},t.send()}function ce(s,e,t,o){return new Promise((i,d)=>{try{s.decodeAudioData(e,t,o),i()}catch(c){console.error(c),console.warn("Error loading sound."),d(c)}})}function de(s,e,t){if(s){if(s.state==="suspended")return{"last-state":s.state,ret:s.resume()};e.buffer=t,e.start(0)}}function he(s){s.suspend()}function fe(s,e){e.disconnect(),s.close().catch(t=>{console.error(t),console.warn("Error closing sound.")})}function pe(s,e,t,o,i,d="center"){const c=s.createLinearGradient(0,0,0,300);return c.addColorStop(1,e),s.fillStyle=c,s.shadowBlur=t,s.shadowColor=o,s.font=i,s.textAlign=d,c}function me(s,e,t,o,i=40,d="Music OFF",c="bold"){s.font=`${c} ${i}px ${o}`,s.fillText(d,e,t)}function ve(s,e,t,o,i,d,c,S="bold"){const r=e.width/2,h=e.height/2,m=i;s.font=`${S} ${c}px ${d}`,s.textBaseline="top",s.fillText(`by ${o}`,r+m,h),s.font=`${S} ${c}px ${d}`,s.textBaseline="bottom",s.fillText(t,r+m,h)}function ye(s,e,t,o,i,d){let c=`${t}:${o}`;s.fillText(c,e.width/2+i,e.height/2+d)}function ge(s,e,t,o,i,d,c){const S=e.width/2,r=e.height/2,h=Math.floor(t*2*Math.PI/(o+d)),m=Math.floor(h*25/100),B=h-m,I=Math.floor(c.length/h);for(let v=0;v<B;v++){const w=c[v*I],E=v*2*Math.PI/h,b=(3*45-o)*Math.PI/180,x=0,_=t-(w/12-i),C=o,a=w/6+i;s.save(),s.translate(S+d,r+d),s.rotate(E-b),s.fillRect(x,_,C,a),s.restore()}}let A,P=[];const Se={lounge:"renderLounge"};class T{constructor(e){n(this,"isPlaying");n(this,"loading");n(this,"loaded");n(this,"disposed");n(this,"state","not-initialized");n(this,"analyser");n(this,"sourceNode");n(this,"canvasCtx");n(this,"ctx");n(this,"frequencyData");n(this,"duration");n(this,"minutes");n(this,"seconds");n(this,"gradient");n(this,"autoplay");n(this,"loop");n(this,"audioBuffer");n(this,"canvas");n(this,"title");n(this,"author");n(this,"audioSrc");n(this,"style");n(this,"barWidth");n(this,"barHeight");n(this,"barSpacing");n(this,"barColor");n(this,"shadowBlur");n(this,"shadowColor");n(this,"font");n(this,"fontSize");n(this,"_onClick");n(this,"clickHandler");n(this,"onMusicEnded");this.isPlaying=!1,this.autoplay=e.autoplay||!1,this.loop=e.loop.value!==void 0?e.loop:e.loop.value===void 0&&e.loop||y(!1),this.audioBuffer=e.audioBuffer,this.canvas=document.getElementById(e.canvas),this.canvasCtx=this.canvas.getContext("2d"),this.author=e.author||"",this.title=e.title||"",this.ctx=null,this.analyser=null,this.sourceNode=null,this.frequencyData=[],this.audioSrc=e.audioSrc||null,this.duration=0,this.minutes="00",this.seconds="00",this.style=e.style||"lounge",this.barWidth=e.barWidth||2,this.barHeight=e.barHeight||2,this.barSpacing=e.barSpacing||5,this.barColor=e.barColor||"#ffffff",this.shadowBlur=e.shadowBlur||10,this.shadowColor=e.shadowColor||"#ffffff",this.font=e.font||["12px","Helvetica"],this.fontSize=e.fontSize||12,this.gradient=null,this.clickHandler=e.clickHandler||null,this._onClick=null,this.loading=!1,this.loaded=!1,this.disposed=!1,this.onMusicEnded=e.onMusicEnded||null}playSound(e){const t=de(this.ctx,this.sourceNode,e);if(this.isPlaying=!0,this.state="playing",t!=null&&t.ret)return t.ret;this.resetTimer(),this.startTimer(),this.renderFrame()}pauseSound(){he(this.ctx),this.isPlaying=!1,this.state="paused"}startTimer(){var e=this;A=ne(function(){if(e.isPlaying){var t=new Date(e.duration),o=t.getHours(),i=t.getMinutes();e.minutes=o<10?"0"+o:o.toString(),e.seconds=i<10?"0"+i:i.toString(),e.duration=t.setMinutes(i+1)}},1e3)}resetTimer(){var e=new Date(0,0);this.duration=e.getTime()}onError(e){console.info("Error decoding audio file. --",e)}renderFrame(){if(this.cancelAnimationFrames(),P.push(requestAnimationFrame(this.renderFrame.bind(this))),!this.isPlaying)return;this.analyser.getByteFrequencyData(this.frequencyData);const e=this.canvas;this.canvasCtx.clearRect(0,0,e.width,e.height),ye(this.canvasCtx,e,this.minutes,this.seconds,10,80),ve(this.canvasCtx,e,this.title,this.author,10,this.font[1],this.fontSize),this.canvasCtx.font=this.font.join(" "),ge(this.canvasCtx,e,140,this.barWidth,this.barHeight,this.barSpacing,this.frequencyData)}renderByStyleType(){return T[Se[this.style]]}cancelAnimationFrames(){for(;P.length>0;)cancelAnimationFrame(P.pop())}removeListeners(){this._onClick!==null&&document.documentElement.removeEventListener("click",this._onClick),this.cancelAnimationFrames()}bindEvents(){const e=this;this.removeListeners(),this._onClick=t=>{t.target===e.canvas&&(t.stopPropagation(),e.disposed||e.clickHandler(e.ctx.state,t))},document.documentElement.addEventListener("click",this._onClick),e.autoplay&&this.loadSound()}loadSound(){if(!this.loading&&!this.loaded){this.loading=!0,this.state="loading";const e=this.canvas;me(this.canvasCtx,e.width/2+10,e.height/2,this.font[1],this.fontSize),ue(this.audioSrc,t=>{this.loading=!1,ce(this.ctx,t,this.playSound.bind(this),this.onError.bind(this)).then(()=>{this.loaded=!0,this.state="loaded"}).catch(o=>{this.loaded=!1,this.state="error",console.error(o),console.warn("Error loading sound.")})})}}dispose(){const e=this.canvas;this.canvasCtx.clearRect(0,0,e.width,e.height),clearInterval(A),this.removeListeners(),this.loaded&&(this.isPlaying=!1,this.resetTimer(),fe(this.ctx,this.sourceNode),this.ctx=null,this.disposed=!0,this.state="disposed")}static _createVisualizer(e){const t=new T(e);return async function(){return t.ctx=await ie(),t.analyser=ae(t.ctx),t.frequencyData=re(t.analyser),t.sourceNode=le(t.analyser,t.ctx,t.loop.value,()=>{var o;clearInterval(A),(o=t.sourceNode)==null||o.disconnect(),t.resetTimer(),t.isPlaying=!1,t.loop.value&&(t.sourceNode=t.ctx.createBufferSource()),t.onMusicEnded()}),t.gradient=pe(t.canvasCtx,t.barColor,t.shadowBlur,t.shadowColor,t.font.join(" ")),t.bindEvents(),t}}static getInstance(e){return this._createVisualizer(e)()}}const we=["src","data-author","data-title","type"],Ee=W({__name:"Music",props:{musicFile:String,musicAuthor:String,musicTitle:String,musicType:{default:"audio/mp3",type:String},fgColor:{default:"#0eaedf9e",type:String},shadowColor:{default:"#06272f",type:String},stopIcon:{default:"",type:String},rewindIcon:{default:"",type:String},font:{default:"Gotham Condensed Black",type:String},fontSize:{default:48,type:Number},musicLoop:{default:!0,type:Boolean},onMusicEnded:{default:()=>{},type:Function}},setup(s){j(a=>({"43d49651":u(c),"089a210a":u(S),"88ed5188":u(v)}));const e=s,t=y(),o=y(),i=k("musicSingleton",()=>!1),d=y(),c=y(e.stopIcon.length>0?e.stopIcon:`url("${D("/assets/img/icons/stop.svg")}")`),S=y(e.rewindIcon.length>0?e.rewindIcon:'url("'+D("/assets/img/icons/rock.svg")+'")'),r=y("not-started"),h=a=>{a.preventDefault(),u(r)==="playing"?(g("#canvas","bounce"),p("#canvas","active")):u(r)==="paused"&&(setTimeout(()=>{p("#canvas","bounce")},500),g("#canvas","active"),r.value="not-started",ee(()=>r.value="paused")),p("#canvas","always-show")},m=(a=!0)=>{g(".pause-icon",["paused","closed"]),g("#canvas","paused");try{u(t).loaded||t.value.loadSound(),a&&u(i)&&t.value.playSound(null),r.value="playing"}catch(l){console.error(l),console.warn("Error playing sound"),r.value="disposed"}},B=async a=>{a.preventDefault();const l=document.getElementById("hero");if(!u(t)){i.value=!1,await E()&&(t.value.loadSound(),g(".pause-icon",["closed","paused"]));return}if(u(r)==="playing"){if(!t.value.loaded||!t.value.isPlaying)return;if(t.value.pauseSound(),r.value="paused",l){const f=["hover","foreground"];(!H(l,"foreground")||!H(l,"hover"))&&p(l,f)}p(".pause-icon","paused"),p("#canvas","paused")}else u(r)==="paused"?(t.value.dispose(),r.value="disposed",p(".pause-icon","closed"),t.value=null,d.value=null):u(r)},I=a=>{if(r.value=a==="running"?"playing":a==="suspended"?"paused":a==="closed"?"disposed":"not-started",u(r)!=="playing")if(u(r)==="paused"){const l=document.getElementById("hero");l&&g(l,["foreground"]),m()}else u(r)==="not-started"&&(t.value.loadSound(),m())},v=y("49");k("music-top",()=>v.value);const w=()=>{setTimeout(()=>{v.value=k("music-top").value+"px"},300)},E=async()=>{if(e.musicFile.length>0&&!u(i)){const a={autoplay:!0,loop:te(e.musicLoop),title:e.musicTitle??"",author:e.musicAuthor??"",audioSrc:e.musicFile??"",canvas:"canvas",style:"lounge",barWidth:2,barHeight:2,barSpacing:7,barColor:e.fgColor,shadowBlur:5,shadowColor:e.shadowColor,font:["32px",e.font,""],fontSize:e.fontSize,clickHandler:I,onMusicEnded:e.onMusicEnded,audioBuffer:null};return t.value=await T.getInstance(a),u(t)?(m(!1),i.value=!0,!!u(t)):!1}return i.value=!1,!1},b=a=>{w(),u(i)||E(),p(u(o),"activated")},x=a=>{if(a.target===o.value){a.stopPropagation();const l=document.getElementById("hero");l&&p(l,["hover"])}},_=a=>{if(a.target===o.value){a.stopPropagation();const l=document.getElementById("hero");l&&g(l,["hover"])}},C=()=>{w()};return U(()=>{var a,l,f;z(()=>e.musicFile,M=>{var F,L;(F=t.value)==null||F.pauseSound(),(L=t.value)==null||L.dispose(),i.value=!1,E(),r.value="playing"}),(a=document.querySelector(".app"))==null||a.addEventListener("onDockingStationAvailable",C),z(k("music-top"),()=>{C()},{immediate:!0}),document.documentElement.addEventListener("click",b),(l=o.value)==null||l.addEventListener("mouseenter",x),(f=o.value)==null||f.addEventListener("mouseleave",_)}),J(()=>{var a,l,f,M;(a=document.querySelector(".app"))==null||a.removeEventListener("onDockingStationAvailable",C),(l=t.value)==null||l.dispose(),i.value=!1,document.documentElement.removeEventListener("click",b),(f=o.value)==null||f.removeEventListener("mouseenter",x),(M=o.value)==null||M.removeEventListener("mouseleave",_)}),(a,l)=>{const f=R;return N(),q("div",{class:"music",onClick:h},[$(f,{icon:"pause-icon",onClick:B}),e.musicFile.length>0?(N(),q("audio",{key:0,id:"audio",src:e.musicFile,"data-author":e.musicAuthor,"data-title":e.musicTitle,type:e.musicType},null,8,we)):O("",!0),$(Q,{name:"bounce"},{default:X(()=>[Y(K("canvas",{id:"canvas",width:"340",height:"400",ref_key:"canvas",ref:o},null,512),[[Z,u(r)==="playing"||u(r)==="paused"]])]),_:1})])}}}),ke=se(Ee,[["__scopeId","data-v-4b4f6853"]]);export{ke as default};
