import ee from"./D5YRdBT2.js";import{ax as W,d as ae,r as v,j as k,l as te,n as y,as as re,o as oe,c as ne,B as ie,C as se,t as H,N as h,e as z,a as $,aw as le,aA as w,a2 as P,aa as F,aD as ce,aE as pe,A as ue}from"./BQPgPTdx.js";import{u as me,s as ge}from"./EMbb9RVN.js";import{u as de}from"./CCVlwpkR.js";import{o as fe,s as S,a as A,b as ve,u as ye,l as G}from"./D_P_Mt2j.js";fe({apiKey:S(),libraries:A(ve(S())),language:A(S()),region:A(S()),v:A(ye([G("weekly"),G("beta"),G("alpha")]))});function he(L){let M=Promise.resolve();return me("googleMaps",i=>{const n=(i==null?void 0:i.libraries)||["places"],b=i!=null&&i.language?{language:i.language}:void 0,O=i!=null&&i.region?{region:i.region}:void 0;return{scriptInput:{src:W("https://maps.googleapis.com/maps/api/js",{libraries:n.join(","),key:i==null?void 0:i.apiKey,loading:"async",callback:"google.maps.__ib__",...b,...O})},clientInit:()=>{window.google=window.google||{},window.google.maps=window.google.maps||{},M=new Promise(p=>{window.google.maps.__ib__=p})},schema:void 0,scriptOptions:{use(){return{maps:M.then(()=>window.google.maps)}}}}},L)}const Pe=ae({__name:"ScriptGoogleMaps",props:{trigger:{type:[String,Array,Boolean],default:["mouseenter","mouseover","mousedown"]},aboveTheFold:{type:Boolean},apiKey:{},center:{},centerMarker:{type:Boolean},mapOptions:{},width:{default:640},height:{default:400},placeholderOptions:{},placeholderAttrs:{},rootAttrs:{},markers:{}},emits:["ready","error"],setup(L,{expose:M,emit:i}){var D;const n=L,b=i,O=n.apiKey||((D=ge("googleMaps"))==null?void 0:D.apiKey),p=v(),R=v(),j=v(),B=v(),E=de({trigger:n.trigger,el:R}),{load:U,status:g,onLoaded:J}=he({apiKey:n.apiKey,scriptOptions:{trigger:E}}),u=k(()=>{var e;return w({center:B.value},n.mapOptions,{center:n.center,zoom:15,mapId:(e=n.mapOptions)!=null&&e.styles?void 0:"map"})}),d=v(!1),l=v(),c=v(new Map);function _(e){return typeof e=="string"&&(e.split(",").length>2||e.includes("+"))}function C(e){return new Promise(async a=>{const t=e instanceof Promise?await e:e;t&&t.setMap(null),a()})}async function K(e){if(!e)return;const a=P(e);if(c.value.has(a))return c.value.get(a);const t=new Promise(async r=>{const o=await I("marker"),s=typeof e=="string"?{position:{lat:Number.parseFloat(e.split(",")[0]||"0"),lng:Number.parseFloat(e.split(",")[1]||"0")}}:e,m=w(F(s),{map:F(l.value),position:s.location});r(new o.AdvancedMarkerElement(m))});return c.value.set(a,t),t}const T=new Map;async function N(e){return e&&typeof e=="object"?Promise.resolve(e):T.has(e)?Promise.resolve(T.get(e)):new Promise(async(a,t)=>{p.value||(await U(),await new Promise(o=>{const s=y(p,()=>{s(),o()})})),new p.value.places.PlacesService(l.value).findPlaceFromQuery({query:e,fields:["name","geometry"]},(o,s)=>{var m,f;return s==="OK"&&((f=(m=o==null?void 0:o[0])==null?void 0:m.geometry)!=null&&f.location)?a(o[0].geometry.location):t(new Error(`No location found for ${e}`))})}).then(a=>(T.set(e,a),a))}const x=new Map;function I(e){var t;if(x.has(e))return x.get(e);const a=((t=p.value)==null?void 0:t.importLibrary(e))||new Promise(r=>{const o=y(p,s=>{if(s){const m=s.importLibrary(e);r(m),o()}},{immediate:!0})});return x.set(e,a),a}const Q={googleMaps:p,map:l,createAdvancedMapMarker:K,resolveQueryToLatLang:N,importLibrary:I};M(Q),te(()=>{y(d,e=>{e&&b("ready",Q)}),y(g,e=>{e==="error"&&b("error")}),y(u,()=>{var e;(e=l.value)==null||e.setOptions(u.value)}),y([()=>n.markers,l],async()=>{if(!l.value)return;const e=new Map((n.markers||[]).map(o=>[P(o),o])),a=new Set([...c.value.keys()].filter(o=>!e.has(o))),t=new Set([...e.keys()].filter(o=>!c.value.has(o))),r=P({position:u.value.center});for(const o of a){if(o===r)continue;const s=await c.value.get(o);s&&C(s).then(()=>{c.value.delete(o)})}for(const o of t)K(e.get(o))},{immediate:!0,deep:!0}),y([()=>u.value.center,d,l],async(e,a)=>{if(!l.value)return;let t=F(e[0]);if(t&&(_(t)&&d.value&&(t=await N(t)),l.value.setCenter(t),typeof n.centerMarker>"u"||n.centerMarker)){if(u.value.mapId)return;if(a[0]){const r=P({position:a[0]});c.value.has(r)&&C(c.value.get(r)).then(()=>{c.value.delete(r)})}K({position:t})}},{immediate:!0}),J(async e=>{var r;p.value=await e.maps;const a=u.value.center,t={...u.value,center:!a||_(a)?void 0:a};l.value=new p.value.Map(j.value,t),a&&_(a)&&(B.value=await N(a),(r=l.value)==null||r.setCenter(B.value)),d.value=!0})});function X(e){return e.map(a=>{const t=a.featureType?`feature:${a.featureType}`:"",r=a.elementType?`element:${a.elementType}`:"",o=(a.stylers||[]).map(s=>Object.entries(s).map(([m,f])=>(m==="color"&&typeof f=="string"&&(f=f.replace("#","0x")),`${m}:${f}`)).join("|")).filter(Boolean).join("|");return[t,r,o].filter(Boolean).join("|")}).filter(Boolean)}const V=k(()=>{var t;let e=u.value.center;e&&typeof e=="object"&&(e=`${e.lat},${e.lng}`);const a=w(n.placeholderOptions,{zoom:u.value.zoom,center:e},{size:`${n.width}x${n.height}`,key:O,scale:2,style:(t=n.mapOptions)!=null&&t.styles?X(n.mapOptions.styles):void 0,markers:[...n.markers||[],e].filter(Boolean).map(r=>(typeof r=="object"&&r.location&&(r=r.location),typeof r=="object"&&r.lat?`${r.lat},${r.lng}`:r)).join("|")});return W("https://maps.googleapis.com/maps/api/staticmap",a)}),Y=k(()=>w(n.placeholderAttrs,{src:V.value,alt:"Google Maps Static Map",loading:n.aboveTheFold?"eager":"lazy",style:{cursor:"pointer",width:"100%",objectFit:"cover",height:"100%"}})),Z=k(()=>w(n.rootAttrs,{"aria-busy":g.value==="loading","aria-label":g.value==="awaitingLoad"?"Google Maps Static Map":g.value==="loading"?"Google Maps Map Embed Loading":"Google Maps Embed","aria-live":"polite",role:"application",style:{cursor:"pointer",position:"relative",maxWidth:"100%",width:`${n.width}px`,height:"'auto'",aspectRatio:`${n.width}/${n.height}`},...E instanceof Promise?E.ssrAttrs||{}:{}})),q=ee;return re(async()=>{var e,a,t;await Promise.all([...c.value.entries()].map(([,r])=>C(r))),c.value.clear(),(e=l.value)==null||e.unbindAll(),l.value=void 0,(t=(a=j.value)==null?void 0:a.firstChild)==null||t.remove()}),(e,a)=>(oe(),ne("div",le({ref_key:"rootEl",ref:R},Z.value),[ie(H("div",{ref_key:"mapEl",ref:j,style:{width:"100%",height:"100%",maxWidth:"100%"}},null,512),[[se,d.value]]),d.value?z("",!0):h(e.$slots,"placeholder",{key:0,placeholder:V.value},()=>[H("img",ce(pe(Y.value)),null,16)]),$(g)!=="awaitingLoad"&&!d.value?h(e.$slots,"loading",{key:1},()=>[ue($(q),{color:"black"})]):z("",!0),$(g)==="awaitingLoad"?h(e.$slots,"awaitingLoad",{key:2}):$(g)==="error"?h(e.$slots,"error",{key:3}):z("",!0),h(e.$slots,"default")],16))}});export{Pe as default};
