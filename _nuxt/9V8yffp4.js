var H=Object.defineProperty;var V=(n,e,t)=>e in n?H(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var o=(n,e,t)=>V(n,typeof e!="symbol"?e+"":e,t);import{_ as G}from"./BDu3-jlj.js";import{j as y,d as R,i as W,a as u,E as T,W as F,k as j,G as z,l as U,o as D,c as N,m as q,e as J,n as O,M as X,N as Y,q as Z,T as K,P as v,H as p,z as Q,aD as $,I as ee,_ as te}from"./s_FvfdIt.js";import{s as ne}from"./x_rD_Ya3.js";const oe=512;function se(){return new Promise((n,e)=>{try{window.AudioContext=window.AudioContext??window.webkitAudioContext,n(new window.AudioContext)}catch(t){console.info("Web Audio API is not supported.",t),e(t)}})}function ie(n){const e=n.createAnalyser();return e.smoothingTimeConstant=.6,e.fftSize=oe,e}function ae(n){return new Uint8Array(n.frequencyBinCount)}function re(n,e,t,s=()=>{}){const i=e.createBufferSource();return i.loop=t,i.connect(n),i.connect(e.destination),i.onended=function(){s()},i}function le(n,e){let t=new XMLHttpRequest;t.open("GET",n,!0),t.responseType="arraybuffer",t.onload=function(){e(t.response)},t.send()}function ue(n,e,t,s){return new Promise((i,d)=>{try{n.decodeAudioData(e,t,s),i()}catch(c){console.error(c),console.warn("Error loading sound."),d(c)}})}function ce(n,e,t){if(n){if(n.state==="suspended")return{"last-state":n.state,ret:n.resume()};e.buffer=t,e.start(0)}}function de(n){n.suspend()}function he(n,e){e.disconnect(),n.close().catch(t=>{console.error(t),console.warn("Error closing sound.")})}function fe(n,e,t,s,i,d="center"){const c=n.createLinearGradient(0,0,0,300);return c.addColorStop(1,e),n.fillStyle=c,n.shadowBlur=t,n.shadowColor=s,n.font=i,n.textAlign=d,c}function pe(n,e,t,s,i=40,d="Music OFF",c="bold"){n.font=`${c} ${i}px ${s}`,n.fillText(d,e,t)}function me(n,e,t,s,i,d,c,l="bold"){const g=e.width/2,h=e.height/2,S=i;n.font=`${l} ${c}px ${d}`,n.textBaseline="top",n.fillText(`by ${s}`,g+S,h),n.font=`${l} ${c}px ${d}`,n.textBaseline="bottom",n.fillText(t,g+S,h)}function ve(n,e,t,s,i,d){let c=`${t}:${s}`;n.fillText(c,e.width/2+i,e.height/2+d)}function ye(n,e,t,s,i,d,c){const l=e.width/2,g=e.height/2,h=Math.floor(t*2*Math.PI/(s+d)),S=Math.floor(h*25/100),k=h-S,C=Math.floor(c.length/h);for(let m=0;m<k;m++){const w=c[m*C],b=m*2*Math.PI/h,x=(3*45-s)*Math.PI/180,_=0,E=t-(w/12-i),a=s,r=w/6+i;n.save(),n.translate(l+d,g+d),n.rotate(b-x),n.fillRect(_,E,a,r),n.restore()}}let I,M=[];const ge={lounge:"renderLounge"};class A{constructor(e){o(this,"isPlaying");o(this,"loading");o(this,"loaded");o(this,"disposed");o(this,"state","not-initialized");o(this,"analyser");o(this,"sourceNode");o(this,"canvasCtx");o(this,"audioContext");o(this,"frequencyData");o(this,"duration");o(this,"minutes");o(this,"seconds");o(this,"gradient");o(this,"autoplay");o(this,"loop");o(this,"audioBuffer");o(this,"canvas");o(this,"title");o(this,"author");o(this,"audioSrc");o(this,"style");o(this,"barWidth");o(this,"barHeight");o(this,"barSpacing");o(this,"barColor");o(this,"shadowBlur");o(this,"shadowColor");o(this,"font");o(this,"fontSize");o(this,"_onClick");o(this,"clickHandler");o(this,"onMusicEnded");this.isPlaying=!1,this.autoplay=e.autoplay||!1,this.loop=e.loop.value!==void 0?e.loop:e.loop.value===void 0&&e.loop||y(!1),this.audioBuffer=e.audioBuffer,this.canvas=document.getElementById(e.canvas),this.canvasCtx=this.canvas.getContext("2d"),this.author=e.author||"",this.title=e.title||"",this.audioContext=null,this.analyser=null,this.sourceNode=null,this.frequencyData=[],this.audioSrc=e.audioSrc||null,this.duration=0,this.minutes="00",this.seconds="00",this.style=e.style||"lounge",this.barWidth=e.barWidth||2,this.barHeight=e.barHeight||2,this.barSpacing=e.barSpacing||5,this.barColor=e.barColor||"#ffffff",this.shadowBlur=e.shadowBlur||10,this.shadowColor=e.shadowColor||"#ffffff",this.font=e.font||["12px","Helvetica"],this.fontSize=e.fontSize||12,this.gradient=null,this.clickHandler=e.clickHandler||null,this._onClick=null,this.loading=!1,this.loaded=!1,this.disposed=!1,this.onMusicEnded=e.onMusicEnded||null}playSound(e){const t=ce(this.audioContext,this.sourceNode,e);if(this.isPlaying=!0,this.state="playing",t!=null&&t.ret)return t.ret;this.resetTimer(),this.startTimer(),this.renderFrame()}pauseSound(){de(this.audioContext),this.isPlaying=!1,this.state="paused"}startTimer(){var e=this;I=ne(function(){if(e.isPlaying){var t=new Date(e.duration),s=t.getHours(),i=t.getMinutes();e.minutes=s<10?"0"+s:s.toString(),e.seconds=i<10?"0"+i:i.toString(),e.duration=t.setMinutes(i+1)}},1e3)}resetTimer(){var e=new Date(0,0);this.duration=e.getTime()}onError(e){console.info("Error decoding audio file. --",e)}renderLounge(){const e=this.canvas;ye(this.canvasCtx,e,140,this.barWidth,this.barHeight,this.barSpacing,this.frequencyData)}renderFrame(){if(this.cancelAnimationFrames(),M.push(requestAnimationFrame(this.renderFrame.bind(this))),!this.isPlaying)return;this.analyser.getByteFrequencyData(this.frequencyData);const e=this.canvas;this.canvasCtx.clearRect(0,0,e.width,e.height),ve(this.canvasCtx,e,this.minutes,this.seconds,10,80),me(this.canvasCtx,e,this.title,this.author,10,this.font[1],this.fontSize),this.canvasCtx.font=this.font.join(" "),this.renderByStyleType().bind(this)()}renderByStyleType(){return this[ge[this.style]]}cancelAnimationFrames(){for(;M.length>0;)cancelAnimationFrame(M.pop())}removeListeners(){this._onClick!==null&&document.documentElement.removeEventListener("click",this._onClick),this.cancelAnimationFrames()}bindEvents(){const e=this;this.removeListeners(),this._onClick=t=>{t.target===e.canvas&&(t.stopPropagation(),e.disposed||e.clickHandler(e.audioContext.state,t))},document.documentElement.addEventListener("click",this._onClick),e.autoplay&&this.loadSound()}loadSound(){if(!this.loading&&!this.loaded){this.loading=!0,this.state="loading";const e=this.canvas;pe(this.canvasCtx,e.width/2+10,e.height/2,this.font[1],this.fontSize),le(this.audioSrc,t=>{this.loading=!1,ue(this.audioContext,t,this.playSound.bind(this),this.onError.bind(this)).then(()=>{this.loaded=!0,this.state="loaded"}).catch(s=>{this.loaded=!1,this.state="error",console.error(s),console.warn("Error loading sound.")})})}}initialize(){this.gradient=fe(this.canvasCtx,this.barColor,this.shadowBlur,this.shadowColor,this.font.join(" "))}dispose(){const e=this.canvas;this.canvasCtx.clearRect(0,0,e.width,e.height),clearInterval(I),this.removeListeners(),this.loaded&&(this.isPlaying=!1,this.resetTimer(),he(this.audioContext,this.sourceNode),this.audioContext=null,this.disposed=!0,this.state="disposed")}static _createVisualizer(e){const t=new A(e);return async function(){return t.audioContext=await se(),t.analyser=ie(t.audioContext),t.frequencyData=ae(t.analyser),t.sourceNode=re(t.analyser,t.audioContext,t.loop.value,()=>{var s;clearInterval(I),(s=t.sourceNode)==null||s.disconnect(),t.resetTimer(),t.isPlaying=!1,t.loop.value&&(t.sourceNode=t.audioContext.createBufferSource()),t.onMusicEnded()}),t.initialize(),t.bindEvents(),t}}static getInstance(e){return this._createVisualizer(e)()}}const Se=["src","data-author","data-title","type"],we=R({__name:"Music",props:{musicFile:String,musicAuthor:String,musicTitle:String,musicType:{default:"audio/mp3",type:String},fgColor:{default:"#0eaedf9e",type:String},shadowColor:{default:"#06272f",type:String},stopIcon:{default:"",type:String},rewindIcon:{default:"",type:String},font:{default:"Gotham Condensed Black",type:String},fontSize:{default:48,type:Number},musicLoop:{default:!0,type:Boolean},onMusicEnded:{default:()=>{},type:Function}},setup(n){W(a=>({"5907f631":u(d),c315ee2c:u(c),"51643f1c":u(C)}));const e=n,t=y(),s=y(),i=T("musicSingleton",()=>!1),d=y(e.stopIcon.length>0?e.stopIcon:`url("${F("/assets/img/icons/stop.svg")}")`),c=y(e.rewindIcon.length>0?e.rewindIcon:'url("'+F("/assets/img/icons/rock.svg")+'")'),l=y("not-started"),g=a=>{a.preventDefault(),u(l)==="playing"?(v("#canvas","bounce"),p("#canvas","active")):u(l)==="paused"&&(setTimeout(()=>{p("#canvas","bounce")},500),v("#canvas","active"),l.value="not-started",Q(()=>l.value="paused")),p("#canvas","always-show")},h=(a=!0)=>{v(".pause-icon",["paused","closed"]),v("#canvas","paused");try{u(t).loaded||t.value.loadSound(),a&&u(i)&&t.value.playSound(null),l.value="playing"}catch(r){console.error(r),console.warn("Error playing sound"),l.value="disposed"}},S=async a=>{a.preventDefault();const r=document.getElementById("hero");if(!u(t)){i.value=!1,await w()&&(t.value.loadSound(),v(".pause-icon",["closed","paused"]));return}if(u(l)==="playing"){if(!t.value.loaded||!t.value.isPlaying)return;if(t.value.pauseSound(),l.value="paused",r){const f=["hover","foreground"];(!$(r,"foreground")||!$(r,"hover"))&&p(r,f)}p(".pause-icon","paused"),p("#canvas","paused")}else u(l)==="paused"?(t.value.dispose(),l.value="disposed",p(".pause-icon","closed"),t.value=null):u(l)},k=a=>{if(l.value=a==="running"?"playing":a==="suspended"?"paused":a==="closed"?"disposed":"not-started",u(l)!=="playing")if(u(l)==="paused"){const r=document.getElementById("hero");r&&v(r,["foreground"]),h()}else u(l)==="not-started"&&(t.value.loadSound(),h())},C=y("49");T("music-top",()=>C.value);const m=()=>{setTimeout(()=>{C.value=T("music-top").value+"px"},300)},w=async()=>{if(e.musicFile.length>0&&!u(i)){const a={autoplay:!0,loop:ee(e.musicLoop),title:e.musicTitle??"",author:e.musicAuthor??"",audioSrc:e.musicFile??"",canvas:"canvas",style:"lounge",barWidth:2,barHeight:2,barSpacing:7,barColor:e.fgColor,shadowBlur:5,shadowColor:e.shadowColor,font:["32px",e.font,""],fontSize:e.fontSize,clickHandler:k,onMusicEnded:e.onMusicEnded,audioBuffer:null};return t.value=await A.getInstance(a),u(t)?(h(!1),i.value=!0,!!u(t)):!1}return i.value=!1,!1},b=a=>{var r;m(),u(i)||w(),(r=t.value)==null||r.initialize(),p(u(s),"activated")},x=a=>{if(a.target===s.value){a.stopPropagation();const r=document.getElementById("hero");r&&p(r,["hover"])}},_=a=>{if(a.target===s.value){a.stopPropagation();const r=document.getElementById("hero");r&&v(r,["hover"])}},E=()=>{m()};return j(()=>{var a,r,f;z(()=>e.musicFile,B=>{var L,P;(L=t.value)==null||L.pauseSound(),(P=t.value)==null||P.dispose(),i.value=!1,w(),l.value="not-started"}),(a=document.querySelector(".app"))==null||a.addEventListener("onDockingStationAvailable",E),z(T("music-top"),()=>{E()},{immediate:!0}),document.documentElement.addEventListener("click",b),(r=s.value)==null||r.addEventListener("mouseenter",x),(f=s.value)==null||f.addEventListener("mouseleave",_)}),U(()=>{var a,r,f,B;(a=document.querySelector(".app"))==null||a.removeEventListener("onDockingStationAvailable",E),(r=t.value)==null||r.dispose(),i.value=!1,document.documentElement.removeEventListener("click",b),(f=s.value)==null||f.removeEventListener("mouseenter",x),(B=s.value)==null||B.removeEventListener("mouseleave",_)}),(a,r)=>{const f=G;return D(),N("div",{class:"music",onClick:g},[q(f,{icon:"pause-icon",onClick:S}),e.musicFile.length>0?(D(),N("audio",{key:0,id:"audio",src:e.musicFile,"data-author":e.musicAuthor,"data-title":e.musicTitle,type:e.musicType},null,8,Se)):J("",!0),q(K,{name:"bounce"},{default:O(()=>[X(Z("canvas",{id:"canvas",width:"340",height:"400",ref_key:"canvas",ref:s},null,512),[[Y,u(l)==="playing"||u(l)==="paused"]])]),_:1})])}}}),_e=te(we,[["__scopeId","data-v-cb648869"]]);export{_e as default};
