var H=Object.defineProperty;var V=(n,e,t)=>e in n?H(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var i=(n,e,t)=>V(n,typeof e!="symbol"?e+"":e,t);import{_ as j}from"./BWO2q8st.js";import{i as y,d as G,E as _,V as z,j as R,G as L,az as W,c as D,l as N,b as O,n as J,T as U,e as u,H as f,P as m,ad as X,o as $,J as Y,L as Z,m as K,v as Q,aC as q,q as ee,_ as te}from"./BEzKOgK_.js";import{s as ne}from"./C0qLyAfO.js";const se=512;function oe(){return new Promise((n,e)=>{try{window.AudioContext=window.AudioContext??window.webkitAudioContext,n(new window.AudioContext)}catch(t){console.info("Web Audio API is not supported.",t),e(t)}})}function ie(n){const e=n.createAnalyser();return e.smoothingTimeConstant=.6,e.fftSize=se,e}function ae(n){return new Uint8Array(n.frequencyBinCount)}function re(n,e,t,o=()=>{}){const s=e.createBufferSource();return s.loop=t,s.connect(n),s.connect(e.destination),s.onended=function(){o()},s}function le(n){return new Promise((e,t)=>{let o=new XMLHttpRequest;o.open("GET",n,!0),o.responseType="arraybuffer",o.onload=function(){e(o.response)},o.send()})}function ue(n,e,t,o){return new Promise((s,c)=>{try{n.decodeAudioData(e,t,o),s()}catch(d){console.error(d),console.warn("Error loading sound."),c(d)}})}function ce(n,e,t){if(n){if(n.state==="suspended")return{"last-state":n.state,ret:n.resume()};e.buffer=t,e.start(0)}}function de(n){n.suspend()}function he(n,e){e.disconnect(),n.close().catch(t=>{console.error(t),console.warn("Error closing sound.")})}function fe(n,e,t,o,s,c="center"){const d=n.createLinearGradient(0,0,0,300);return d.addColorStop(1,e),n.fillStyle=d,n.shadowBlur=t,n.shadowColor=o,n.font=s,n.textAlign=c,d}function pe(n,e,t,o,s=40,c="Music OFF",d="bold"){n.font=`${d} ${s}px ${o}`,n.fillText(c,e,t)}function me(n,e,t,o,s,c,d,l="bold"){const S=e.width/2,h=e.height/2,w=s;n.font=`${l} ${d}px ${c}`,n.textBaseline="top",n.fillText(`by ${o}`,S+w,h),n.font=`${l} ${d}px ${c}`,n.textBaseline="bottom",n.fillText(t,S+w,h)}function ve(n,e,t,o,s,c){let d=`${t}:${o}`;n.fillText(d,e.width/2+s,e.height/2+c)}function ge(n,e,t,o,s,c,d){const l=e.width/2,S=e.height/2,h=Math.floor(t*2*Math.PI/(o+c)),w=Math.floor(h*25/100),x=h-w,b=Math.floor(d.length/h);for(let v=0;v<x;v++){const C=d[v*b],B=v*2*Math.PI/h,T=(3*45-o)*Math.PI/180,k=0,E=t-(C/12-s),g=o,a=C/6+s;n.save(),n.translate(l+c,S+c),n.rotate(B-T),n.fillRect(k,E,g,a),n.restore()}}let I,M=[];const ye={lounge:"renderLounge"};class A{constructor(e){i(this,"isPlaying");i(this,"loading");i(this,"loaded");i(this,"disposed");i(this,"state","not-initialized");i(this,"analyser");i(this,"sourceNode");i(this,"canvasCtx");i(this,"audioContext");i(this,"frequencyData");i(this,"duration");i(this,"minutes");i(this,"seconds");i(this,"gradient");i(this,"autoplay");i(this,"loop");i(this,"canvas");i(this,"title");i(this,"author");i(this,"audioSrc");i(this,"style");i(this,"barWidth");i(this,"barHeight");i(this,"barSpacing");i(this,"barColor");i(this,"shadowBlur");i(this,"shadowColor");i(this,"font");i(this,"fontSize");i(this,"_onClick");i(this,"clickHandler");i(this,"onMusicEnded");i(this,"fetchBufferSrc");this.isPlaying=!1,this.autoplay=e.autoplay||!1,this.loop=e.loop.value!==void 0?e.loop:e.loop.value===void 0&&e.loop||y(!1),this.canvas=document.getElementById(e.canvas),this.canvasCtx=this.canvas.getContext("2d"),this.author=e.author||"",this.title=e.title||"",this.audioContext=null,this.analyser=null,this.sourceNode=null,this.frequencyData=[],this.audioSrc=e.audioSrc||null,this.duration=0,this.minutes="00",this.seconds="00",this.style=e.style||"lounge",this.barWidth=e.barWidth||2,this.barHeight=e.barHeight||2,this.barSpacing=e.barSpacing||5,this.barColor=e.barColor||"#ffffff",this.shadowBlur=e.shadowBlur||10,this.shadowColor=e.shadowColor||"#ffffff",this.font=e.font||["12px","Helvetica"],this.fontSize=e.fontSize||12,this.gradient=null,this.clickHandler=e.clickHandler||null,this._onClick=null,this.loading=!1,this.loaded=!1,this.disposed=!1,this.onMusicEnded=e.onMusicEnded||null,this.fetchBufferSrc=e.fetchBufferSrc||null}playSound(e){const t=ce(this.audioContext,this.sourceNode,e);if(this.isPlaying=!0,this.state="playing",t!=null&&t.ret)return t.ret;this.resetTimer(),this.startTimer(),this.renderFrame()}pauseSound(){de(this.audioContext),this.isPlaying=!1,this.state="paused"}startTimer(){var e=this;I=ne(function(){if(e.isPlaying){var t=new Date(e.duration),o=t.getHours(),s=t.getMinutes();e.minutes=o<10?"0"+o:o.toString(),e.seconds=s<10?"0"+s:s.toString(),e.duration=t.setMinutes(s+1)}},1e3)}resetTimer(){var e=new Date(0,0);this.duration=e.getTime()}onError(e){console.info("Error decoding audio file. --",e)}renderLounge(){const e=this.canvas;ge(this.canvasCtx,e,140,this.barWidth,this.barHeight,this.barSpacing,this.frequencyData)}renderFrame(){if(this.cancelAnimationFrames(),M.push(requestAnimationFrame(this.renderFrame.bind(this))),!this.isPlaying)return;this.analyser.getByteFrequencyData(this.frequencyData);const e=this.canvas;this.canvasCtx.clearRect(0,0,e.width,e.height),ve(this.canvasCtx,e,this.minutes,this.seconds,10,80),me(this.canvasCtx,e,this.title,this.author,10,this.font[1],this.fontSize),this.canvasCtx.font=this.font.join(" "),this.renderByStyleType().bind(this)()}renderByStyleType(){return this[ye[this.style]]}cancelAnimationFrames(){for(;M.length>0;)cancelAnimationFrame(M.pop())}removeListeners(){this._onClick!==null&&document.documentElement.removeEventListener("click",this._onClick),this.cancelAnimationFrames()}bindEvents(){const e=this;this.removeListeners(),this._onClick=t=>{t.target===e.canvas&&(t.stopPropagation(),e.disposed||e.clickHandler(e.audioContext.state,t))},document.documentElement.addEventListener("click",this._onClick),e.autoplay&&this.loadSound()}loadSound(){if(!this.loading&&!this.loaded){this.loading=!0,this.state="loading";const e=this.canvas;pe(this.canvasCtx,e.width/2+10,e.height/2,this.font[1],this.fontSize);const t=s=>{this.loaded=!1,this.state="error",console.error(s),console.warn("Error loading sound.")},o=s=>{ue(this.audioContext,s,this.playSound.bind(this),this.onError.bind(this)).then(()=>{this.loaded=!0,this.state="loaded"}).catch(c=>{t(c)})};this.fetchBufferSrc!==null?this.fetchBufferSrc(this.audioSrc||"").then(s=>{if(s===null)return t("buffer is null"),null;o(s)}):le(this.audioSrc).then(s=>{this.loading=!1,o(s)})}}initialize(){this.gradient=fe(this.canvasCtx,this.barColor,this.shadowBlur,this.shadowColor,this.font.join(" "))}dispose(){const e=this.canvas;this.canvasCtx.clearRect(0,0,e.width,e.height),clearInterval(I),this.removeListeners(),this.loaded&&(this.isPlaying=!1,this.resetTimer(),he(this.audioContext,this.sourceNode),this.audioContext=null,this.disposed=!0,this.state="disposed")}static _createVisualizer(e){const t=new A(e);return async function(){return t.audioContext=await oe(),t.analyser=ie(t.audioContext),t.frequencyData=ae(t.analyser),t.sourceNode=re(t.analyser,t.audioContext,t.loop.value,()=>{var o;clearInterval(I),(o=t.sourceNode)==null||o.disconnect(),t.resetTimer(),t.isPlaying=!1,t.loop.value&&(t.sourceNode=t.audioContext.createBufferSource()),t.onMusicEnded()}),t.initialize(),t.bindEvents(),t}}static getInstance(e){return this._createVisualizer(e)()}}const Se=["src","data-author","data-title","type"],we=G({__name:"Music",props:{musicFile:String,musicAuthor:String,musicTitle:String,musicType:{default:"audio/mp3",type:String},fgColor:{default:"#0eaedf9e",type:String},shadowColor:{default:"#06272f",type:String},stopIcon:{default:"",type:String},rewindIcon:{default:"",type:String},font:{default:"Gotham Condensed Black",type:String},fontSize:{default:48,type:Number},musicLoop:{default:!0,type:Boolean},onMusicEnded:{default:()=>{},type:Function},fetchBufferSrc:null},setup(n){Q(a=>({"19517fdc":u(c),"7282d3d5":u(d),"25720a07":u(b)}));const e=n,t=y(),o=y(),s=_("musicSingleton",()=>!1),c=y(e.stopIcon.length>0?e.stopIcon:`url("${z("/assets/img/icons/stop.svg")}")`),d=y(e.rewindIcon.length>0?e.rewindIcon:'url("'+z("/assets/img/icons/rock.svg")+'")'),l=y("not-started"),S=a=>{a.preventDefault(),u(l)==="playing"?(m("#canvas","bounce"),f("#canvas","active")):u(l)==="paused"&&(setTimeout(()=>{f("#canvas","bounce")},500),m("#canvas","active"),l.value="not-started",ee(()=>l.value="paused")),f("#canvas","always-show")},h=(a=!0)=>{m(".pause-icon",["paused","closed"]),m("#canvas","paused");try{u(t).loaded||t.value.loadSound(),a&&u(s)&&t.value.playSound(null),l.value="playing"}catch(r){console.error(r),console.warn("Error playing sound"),l.value="error"}},w=async a=>{a.preventDefault();const r=document.getElementById("hero");if(!u(t)){s.value=!1,await C()&&(t.value.loadSound(),m(".pause-icon",["closed","paused"])),f(r,"foreground");return}if(u(l)==="playing"){if(!t.value.loaded||!t.value.isPlaying)return;if(t.value.pauseSound(),l.value="paused",r){const p=["hover","foreground"];(!q(r,p[0])||!q(r,p[1]))&&f(r,p)}f(".pause-icon","paused"),f("#canvas","paused")}else u(l)==="paused"?(t.value.dispose(),l.value="disposed",m(r,"foreground"),f(".pause-icon","closed"),t.value=null):u(l)},x=a=>{if(l.value=a==="running"?"playing":a==="suspended"?"paused":a==="closed"?"disposed":"not-started",u(l)!=="playing")if(u(l)==="paused"){const r=document.getElementById("hero");r&&m(r,["foreground"]),h()}else u(l)==="not-started"&&h()},b=y("49");_("music-top",()=>b.value);const v=()=>{setTimeout(()=>{b.value=_("music-top").value+"px"},300)},C=async()=>{if(e.musicFile.length>0&&!u(s)){const a={autoplay:!0,loop:X(e.musicLoop),title:e.musicTitle??"",author:e.musicAuthor??"",audioSrc:e.musicFile??"",canvas:"canvas",style:"lounge",barWidth:2,barHeight:2,barSpacing:7,barColor:e.fgColor,shadowBlur:5,shadowColor:e.shadowColor,font:["32px",e.font,""],fontSize:e.fontSize,clickHandler:x,onMusicEnded:e.onMusicEnded,fetchBufferSrc:e.fetchBufferSrc};return t.value=await A.getInstance(a),u(t)?(h(!1),s.value=!0,!!u(t)):!1}return s.value=!1,!1},B=a=>{var r;v(),u(s)||C(),(r=t.value)==null||r.initialize(),f(u(o),"activated")},T=a=>{if(a.target===o.value){a.stopPropagation();const r=document.getElementById("hero");r&&f(r,["hover"])}},k=a=>{if(a.target===o.value){a.stopPropagation();const r=document.getElementById("hero");r&&m(r,["hover"])}},E=()=>{v()},g=new AbortController;return R(()=>{var a,r,p;L(()=>e.musicFile,be=>{var P,F;(P=t.value)==null||P.pauseSound(),(F=t.value)==null||F.dispose(),s.value=!1,C(),l.value="not-started"}),(a=document.querySelector(".app"))==null||a.addEventListener("onDockingStationAvailable",E,{signal:g.signal}),L(_("music-top"),()=>{E()},{immediate:!0}),document.documentElement.addEventListener("click",B,{signal:g.signal}),(r=o.value)==null||r.addEventListener("mouseenter",T,{signal:g.signal}),(p=o.value)==null||p.addEventListener("mouseleave",k,{signal:g.signal})}),W(()=>{var a;(a=t.value)==null||a.dispose(),s.value=!1,g.abort()}),(a,r)=>{const p=j;return $(),D("div",{class:"music",onClick:S},[N(p,{icon:"pause-icon",onClick:w}),e.musicFile.length>0?($(),D("audio",{key:0,id:"audio",src:e.musicFile,"data-author":e.musicAuthor,"data-title":e.musicTitle,type:e.musicType},null,8,Se)):O("",!0),N(U,{name:"bounce"},{default:J(()=>[Y(K("canvas",{id:"canvas",width:"340",height:"400",ref_key:"canvas",ref:o},null,512),[[Z,u(l)==="playing"||u(l)==="paused"]])]),_:1})])}}}),Ce=te(we,[["__scopeId","data-v-2b7bd246"]]),Te=Object.freeze(Object.defineProperty({__proto__:null,default:Ce},Symbol.toStringTag,{value:"Module"}));export{Te as M,Ce as _,le as l};
