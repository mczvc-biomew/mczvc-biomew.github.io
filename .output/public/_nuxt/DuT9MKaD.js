var j=Object.defineProperty;var G=(n,e,t)=>e in n?j(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var i=(n,e,t)=>G(n,typeof e!="symbol"?e+"":e,t);import{_ as R}from"./BQXLk8Mu.js";import{r as S,d as W,G as x,g as D,f as O,H as N,aC as U,c as $,m as H,b as J,p as K,T as Q,e as c,Q as g,I as h,aF as q,ag as X,o as V,K as Y,M as Z,n as ee,x as te,v as ne,_ as se}from"./DnXN9yO2.js";import{s as oe}from"./0RGqL-XT.js";const ie=512;function ae(){return new Promise((n,e)=>{try{window.AudioContext=window.AudioContext??window.webkitAudioContext,n(new window.AudioContext)}catch(t){console.info("Web Audio API is not supported.",t),e(t)}})}function re(n){const e=n.createAnalyser();return e.smoothingTimeConstant=.6,e.fftSize=ie,e}function le(n){return new Uint8Array(n.frequencyBinCount)}function ue(n,e,t,s=()=>{}){const o=e.createBufferSource();return o.loop=t,o.connect(n),o.connect(e.destination),o.onended=function(){s()},o}function ce(n){return new Promise((e,t)=>{let s=new XMLHttpRequest;s.open("GET",n,!0),s.responseType="arraybuffer",s.onload=function(){e(s.response)},s.send()})}function de(n,e,t,s){return new Promise((o,a)=>{try{n.decodeAudioData(e,t,s),o()}catch(d){console.error(d),console.warn("Error loading sound."),a(d)}})}function he(n,e,t){if(n){if(n.state==="suspended")return{"last-state":n.state,ret:n.resume()};e.buffer=t,e.start(0)}}function fe(n){n.suspend()}function pe(n,e){e.disconnect(),n.close().catch(t=>{console.error(t),console.warn("Error closing sound.")})}function me(n,e,t,s,o,a="center"){const d=n.createLinearGradient(0,0,0,300);return d.addColorStop(1,e),n.fillStyle=d,n.shadowBlur=t,n.shadowColor=s,n.font=o,n.textAlign=a,d}function ve(n,e,t,s,o=40,a="Music OFF",d="bold"){n.font=`${d} ${o}px ${s}`,n.fillText(a,e,t)}function ge(n,e,t,s,o,a,d,w="bold"){const l=e.width/2,f=e.height/2,p=o;n.font=`${w} ${d}px ${a}`,n.textBaseline="top",n.fillText(`by ${s}`,l+p,f),n.font=`${w} ${d}px ${a}`,n.textBaseline="bottom",n.fillText(t,l+p,f)}function ye(n,e,t,s,o,a){let d=`${t}:${s}`;n.fillText(d,e.width/2+o,e.height/2+a)}function Se(n,e,t,s,o,a,d){const w=e.width/2,l=e.height/2,f=Math.floor(t*2*Math.PI/(s+a)),p=Math.floor(f*25/100),_=f-p,B=Math.floor(d.length/f);for(let m=0;m<_;m++){const C=d[m*B],b=m*2*Math.PI/f,T=(3*45-s)*Math.PI/180,k=0,I=t-(C/12-o),E=s,y=C/6+o;n.save(),n.translate(w+a,l+a),n.rotate(b-T),n.fillRect(k,I,E,y),n.restore()}}let A,P=[];const we={lounge:"renderLounge"};class F{constructor(e){i(this,"isPlaying");i(this,"loading");i(this,"loaded");i(this,"disposed");i(this,"state","not-initialized");i(this,"analyser");i(this,"sourceNode");i(this,"canvasCtx");i(this,"audioContext");i(this,"frequencyData");i(this,"duration");i(this,"minutes");i(this,"seconds");i(this,"gradient");i(this,"autoplay");i(this,"loop");i(this,"canvas");i(this,"title");i(this,"author");i(this,"audioSrc");i(this,"style");i(this,"barWidth");i(this,"barHeight");i(this,"barSpacing");i(this,"barColor");i(this,"shadowBlur");i(this,"shadowColor");i(this,"font");i(this,"fontSize");i(this,"_onClick");i(this,"clickHandler");i(this,"onMusicEnded");i(this,"fetchBufferSrc");this.isPlaying=!1,this.autoplay=e.autoplay||!1,this.loop=e.loop.value!==void 0?e.loop:e.loop.value===void 0&&e.loop||S(!1),this.canvas=document.getElementById(e.canvas),this.canvasCtx=this.canvas.getContext("2d"),this.author=e.author||"",this.title=e.title||"",this.audioContext=null,this.analyser=null,this.sourceNode=null,this.frequencyData=[],this.audioSrc=e.audioSrc||null,this.duration=0,this.minutes="00",this.seconds="00",this.style=e.style||"lounge",this.barWidth=e.barWidth||2,this.barHeight=e.barHeight||2,this.barSpacing=e.barSpacing||5,this.barColor=e.barColor||"#ffffff",this.shadowBlur=e.shadowBlur||10,this.shadowColor=e.shadowColor||"#ffffff",this.font=e.font||["12px","Helvetica"],this.fontSize=e.fontSize||12,this.gradient=null,this.clickHandler=e.clickHandler||null,this._onClick=null,this.loading=!1,this.loaded=!1,this.disposed=!1,this.onMusicEnded=e.onMusicEnded||null,this.fetchBufferSrc=e.fetchBufferSrc||null}playSound(e){const t=he(this.audioContext,this.sourceNode,e);if(this.isPlaying=!0,this.state="playing",t!=null&&t.ret)return t.ret;this.resetTimer(),this.startTimer(),this.renderFrame()}pauseSound(){fe(this.audioContext),this.isPlaying=!1,this.state="paused"}startTimer(){var e=this;A=oe(function(){if(e.isPlaying){var t=new Date(e.duration),s=t.getHours(),o=t.getMinutes();e.minutes=s<10?"0"+s:s.toString(),e.seconds=o<10?"0"+o:o.toString(),e.duration=t.setMinutes(o+1)}},1e3)}resetTimer(){var e=new Date(0,0);this.duration=e.getTime()}onError(e){console.info("Error decoding audio file. --",e)}renderLounge(){const e=this.canvas;Se(this.canvasCtx,e,140,this.barWidth,this.barHeight,this.barSpacing,this.frequencyData)}renderFrame(){if(this.cancelAnimationFrames(),P.push(requestAnimationFrame(this.renderFrame.bind(this))),!this.isPlaying)return;this.analyser.getByteFrequencyData(this.frequencyData);const e=this.canvas;this.canvasCtx.clearRect(0,0,e.width,e.height),ye(this.canvasCtx,e,this.minutes,this.seconds,10,80),ge(this.canvasCtx,e,this.title,this.author,10,this.font[1],this.fontSize),this.canvasCtx.font=this.font.join(" "),this.renderByStyleType().bind(this)()}renderByStyleType(){return this[we[this.style]]}cancelAnimationFrames(){for(;P.length>0;)cancelAnimationFrame(P.pop())}removeListeners(){this._onClick!==null&&document.documentElement.removeEventListener("click",this._onClick),this.cancelAnimationFrames()}bindEvents(){const e=this;this.removeListeners(),this._onClick=t=>{t.target===e.canvas&&(t.stopPropagation(),e.disposed||e.clickHandler(e.audioContext.state,t))},document.documentElement.addEventListener("click",this._onClick),e.autoplay&&this.loadSound()}loadSound(){if(!this.loading&&!this.loaded){this.loading=!0,this.state="loading";const e=this.canvas;ve(this.canvasCtx,e.width/2+10,e.height/2,this.font[1],this.fontSize);const t=o=>{this.loaded=!1,this.state="error",console.error(o),console.warn("Error loading sound.")},s=o=>{de(this.audioContext,o,this.playSound.bind(this),this.onError.bind(this)).then(()=>{this.loaded=!0,this.state="loaded"}).catch(a=>{t(a)})};this.fetchBufferSrc!==null?this.fetchBufferSrc(this.audioSrc||"").then(o=>{if(o===null)return t("buffer is null"),null;s(o)}):ce(this.audioSrc).then(o=>{this.loading=!1,s(o)})}}initialize(){this.gradient=me(this.canvasCtx,this.barColor,this.shadowBlur,this.shadowColor,this.font.join(" "))}dispose(){const e=this.canvas;this.canvasCtx.clearRect(0,0,e.width,e.height),clearInterval(A),this.removeListeners(),this.loaded&&(this.isPlaying=!1,this.resetTimer(),pe(this.audioContext,this.sourceNode),this.audioContext=null,this.disposed=!0,this.state="disposed")}static _createVisualizer(e){const t=new F(e);return async function(){return t.audioContext=await ae(),t.analyser=re(t.audioContext),t.frequencyData=le(t.analyser),t.sourceNode=ue(t.analyser,t.audioContext,t.loop.value,()=>{var s;clearInterval(A),(s=t.sourceNode)==null||s.disconnect(),t.resetTimer(),t.isPlaying=!1,t.loop.value&&(t.sourceNode=t.audioContext.createBufferSource()),t.onMusicEnded()}),t.initialize(),t.bindEvents(),t}}static getInstance(e){return this._createVisualizer(e)()}}const Ce=["src","data-author","data-title","type"],be=W({__name:"Music",props:{musicFile:String,musicAuthor:String,musicTitle:String,musicType:{default:"audio/mp3",type:String},fgColor:{default:"#0eaedf9e",type:String},shadowColor:{default:"#06272f",type:String},stopIcon:{default:"",type:String},rewindIcon:{default:"",type:String},font:{default:"Gotham Condensed Black",type:String},fontSize:{default:48,type:Number},musicLoop:{default:!0,type:Boolean},onMusicEnded:{default:()=>{},type:Function},fetchBufferSrc:null},setup(n,{expose:e}){te(u=>({"1edf600c":c(d),"754e1473":c(w),"283d4aa5":c(m)}));const t=n,s=S(),o=S(),a=x("musicSingleton",()=>!1),d=S(t.stopIcon.length>0?t.stopIcon:`url("${D("/assets/img/icons/stop.svg")}")`),w=S(t.rewindIcon.length>0?t.rewindIcon:'url("'+D("/assets/img/icons/rock.svg")+'")'),l=S("not-started"),f=u=>{u.preventDefault(),c(l)==="playing"?(g("#canvas","bounce"),h("#canvas","active")):c(l)==="paused"&&(setTimeout(()=>{h("#canvas","bounce")},500),g("#canvas","active"),l.value="not-started",ne(()=>l.value="paused")),h("#canvas","always-show")},p=(u=!0)=>{g(".pause-icon",["paused","closed"]),g("#canvas","paused");try{c(s).loaded||s.value.loadSound(),u&&c(a)&&s.value.playSound(null),l.value="playing"}catch(r){console.error(r),console.warn("Error playing sound"),l.value="error"}},_=async u=>{u.preventDefault();const r=document.getElementById("hero");if(!c(s)){a.value=!1,await b()&&(s.value.loadSound(),g(".pause-icon",["closed","paused"])),h(r,"foreground");return}if(c(l)==="playing"){if(!s.value.loaded||!s.value.isPlaying)return;if(s.value.pauseSound(),l.value="paused",r){const v=["hover","foreground"];(!q(r,v[0])||!q(r,v[1]))&&h(r,v)}h(".pause-icon","paused"),h("#canvas","paused")}else c(l)==="paused"?(s.value.dispose(),l.value="disposed",g(r,"foreground"),h(".pause-icon","closed"),s.value=null):c(l)},B=u=>{if(l.value=u==="running"?"playing":u==="suspended"?"paused":u==="closed"?"disposed":"not-started",c(l)!=="playing")if(c(l)==="paused"){const r=document.getElementById("hero");r&&g(r,["foreground"]),p()}else c(l)==="not-started"&&p()},m=S("49");x("music-top",()=>m.value);const C=()=>{setTimeout(()=>{m.value=x("music-top").value+"px"},300)},b=async()=>{if(t.musicFile.length>0&&!c(a)){const u={autoplay:!0,loop:X(t.musicLoop),title:t.musicTitle??"",author:t.musicAuthor??"",audioSrc:t.musicFile??"",canvas:"canvas",style:"lounge",barWidth:2,barHeight:2,barSpacing:7,barColor:t.fgColor,shadowBlur:5,shadowColor:t.shadowColor,font:["32px",t.font,""],fontSize:t.fontSize,clickHandler:B,onMusicEnded:t.onMusicEnded,fetchBufferSrc:t.fetchBufferSrc};return s.value=await F.getInstance(u),c(s)?(p(!1),a.value=!0,!!c(s)):!1}return a.value=!1,!1},T=u=>{var r;C(),c(a)||b(),(r=s.value)==null||r.initialize(),h(c(o),"activated")},k=u=>{if(u.target===o.value){u.stopPropagation();const r=document.getElementById("hero");r&&h(r,["hover"])}},I=u=>{if(u.target===o.value){u.stopPropagation();const r=document.getElementById("hero");r&&g(r,["hover"])}},E=()=>{C()},y=new AbortController;return e({pause:_}),O(()=>{var u,r,v;N(()=>t.musicFile,M=>{var z,L;(z=s.value)==null||z.pauseSound(),(L=s.value)==null||L.dispose(),a.value=!1,b(),l.value="not-started"}),(u=document.querySelector(".app"))==null||u.addEventListener("onDockingStationAvailable",E,{signal:y.signal}),N(x("music-top"),()=>{E()},{immediate:!0}),document.documentElement.addEventListener("click",T,{signal:y.signal}),(r=o.value)==null||r.addEventListener("mouseenter",k,{signal:y.signal}),(v=o.value)==null||v.addEventListener("mouseleave",I,{signal:y.signal}),U(()=>{var M;(M=s.value)==null||M.dispose(),a.value=!1,y.abort()})}),(u,r)=>{const v=R;return V(),$("div",{class:"music",onClick:f},[H(v,{icon:"pause-icon",onClick:_}),t.musicFile.length>0?(V(),$("audio",{key:0,id:"audio",src:t.musicFile,"data-author":t.musicAuthor,"data-title":t.musicTitle,type:t.musicType},null,8,Ce)):J("",!0),H(Q,{name:"bounce"},{default:K(()=>[Y(ee("canvas",{id:"canvas",width:"340",height:"400",ref_key:"canvas",ref:o},null,512),[[Z,c(l)==="playing"||c(l)==="paused"]])]),_:1})])}}}),_e=se(be,[["__scopeId","data-v-9d693240"]]),ke=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"}));export{ke as M,_e as _,ce as l};
